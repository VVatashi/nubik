(()=>{var Ge=Object.defineProperty;var Xe=(s,e,t)=>e in s?Ge(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var he=(s,e,t)=>Xe(s,typeof e!="symbol"?e+"":e,t);var Q=class{constructor(){let e=new AudioContext,t=e.createGain();t.connect(e.destination),t.gain.value=.2,this.context=e,this.gainNode=t}resume(){let{context:e}=this;return e.resume(),this}suspend(){let{context:e}=this;return e.suspend(),this}play(e,t=!1){let{context:n,gainNode:r}=this,i=n.createBufferSource();return i.buffer=e,i.loop=t,i.connect(r),i.start(),this}};var q=class{constructor(e,t,n){let r=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,r),e.renderbufferStorageMultisample(e.RENDERBUFFER,e.getParameter(e.MAX_SAMPLES),e.RGBA8,t,n),this.context=e,this.handle=r,this.width=t,this.height=n}bind(){let{context:e,handle:t}=this;return e.bindRenderbuffer(e.RENDERBUFFER,t),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteRenderbuffer(t),this.handle=null)}},N=class{constructor(e,t,n){let r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.viewport(0,0,t,n),e.bindFramebuffer(e.FRAMEBUFFER,null),this.context=e,this.handle=r,this.width=t,this.height=n}attachTexture(e){let{context:t,attachment:n}=this;return this.bind(),e.bind(),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.handle,0),this.attachment=e,this.unbind(),n?.delete(),this}attachRenderbuffer(e){let{context:t,attachment:n}=this;return this.bind(),e.bind(),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,e.handle),this.attachment=e,this.unbind(),n?.delete(),this}resize(e,t){let{context:n}=this;return this.bind(),n.viewport(0,0,e,t),this.unbind(),this.width=e,this.height=t,this}bind(){let{context:e,handle:t}=this;return e.bindFramebuffer(e.FRAMEBUFFER,t),this}unbind(){let{context:e}=this;return e.bindFramebuffer(e.FRAMEBUFFER,null),this}blit(e){let{context:t,width:n,height:r}=this;return t.bindFramebuffer(t.READ_FRAMEBUFFER,this.handle),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,e.handle),t.blitFramebuffer(0,0,n,r,0,0,e.width,e.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteFramebuffer(t),this.handle=null)}},Z=class{constructor(e,t,n){let r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Can't compile shader: "+e.getShaderInfoLog(r));this.context=e,this.handle=r}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteShader(t),this.handle=null)}},P=class{constructor(e,t,n){let r=new Z(e,e.VERTEX_SHADER,t),i=new Z(e,e.FRAGMENT_SHADER,n),o=e.createProgram();if(e.attachShader(o,r.handle),e.attachShader(o,i.handle),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error("Can't link shader program: "+e.getProgramInfoLog(o));r.delete(),i.delete(),this.context=e,this.handle=o,this.uniformLocationCache={}}bind(){let{context:e,handle:t}=this;return e.useProgram(t),this}getUniformLocation(e){let{context:t,handle:n,uniformLocationCache:r}=this;return e in r?r[e]:r[e]=t.getUniformLocation(n,e)}setUniform(e,t){let{context:n}=this;this.bind();let r=this.getUniformLocation(e);return typeof t=="boolean"?n.uniform1i(r,t?1:0):n.uniform1f(r,t),this}setUniformInteger(e,t){let{context:n}=this;this.bind();let r=this.getUniformLocation(e);return n.uniform1i(r,t),this}setUniformMatrix(e,t,n=!1){let{context:r}=this;this.bind();let i=this.getUniformLocation(e);return r.uniformMatrix4fv(i,n,t),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteProgram(t),this.handle=null)}},O=class{constructor(e,t,n,r,i=e.RGBA8){let o=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(t,o),e.texImage2D(t,0,i,n,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(t,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(t,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(t,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.LINEAR),this.context=e,this.handle=o,this.type=t}bind(e=0){let{context:t,handle:n,type:r}=this;return t.activeTexture(e+t.TEXTURE0),t.bindTexture(r,n),this}setImage(e){let{context:t,type:n}=this;return this.bind(),t.texSubImage2D(n,0,0,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(n,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.generateMipmap(n),this}setParameter(e,t){let{context:n,type:r}=this;return this.bind(),n.texParameteri(r,e,t),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteTexture(t),this.handle=null)}},ue=class{constructor(e,t,n,r=e.STATIC_DRAW){let i=e.createBuffer();e.bindBuffer(t,i),e.bufferData(t,n,r),this.context=e,this.handle=i,this.type=t,this.usage=r}bind(){let{context:e,handle:t,type:n}=this;return e.bindBuffer(n,t),this}setData(e){let{context:t,type:n}=this;return this.bind(),t.bufferData(n,e,this.usage),this}setDataRange(e,t,n){let{context:r,type:i}=this;return this.bind(),r.bufferSubData(i,t,e,0,n),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteBuffer(t),this.handle=null)}},H=class{constructor(e,t,n,r,i){this.elements=e,this.type=t,this.normalized=n,this.stride=r,this.offset=i}},de=class{constructor(e,t,n){let r=e.createVertexArray();e.bindVertexArray(r),t.bind();for(let i=0;i<n.length;i++){e.enableVertexAttribArray(i);let o=n[i];e.vertexAttribPointer(i,o.elements,o.type,o.normalized,o.stride,o.offset)}e.bindVertexArray(null),this.context=e,this.handle=r}bind(){let{context:e,handle:t}=this;return e.bindVertexArray(t),this}unnbind(){let{context:e}=this;return e.bindVertexArray(null),this}draw(e){let{context:t}=this;return this.bind(),t.drawArrays(t.TRIANGLES,0,e),this.unnbind(),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteVertexArray(t),this.handle=null)}},fe=class{constructor(e,t,n,r=e.STATIC_DRAW){let i=0;for(let c of n)i+=c.elements;let o=new ue(e,e.ARRAY_BUFFER,new Float32Array(i*t),r),a=new de(e,o,n);this.context=e,this.vertexCount=t,this.vertexArray=a,this.vertexBuffer=o}setData(e){return this.vertexBuffer.setData(e),this}setDataRange(e,t,n){return this.vertexBuffer.setDataRange(e,t,n),this}draw(e=null){return this.vertexArray.draw(e||this.vertexCount),this}delete(){this.vertexArray.delete(),this.vertexBuffer.delete()}},$=class{constructor(){this.glyphs={}}deserializeDataFromCSV(e,t,n){let r=e.split(`
`);for(let i of r){let o=i.split(",");if(o.length!==10)continue;let a=Number(o[0]),c=Number(o[1]),h=Number(o[2]),l=1-Number(o[3]),u=Number(o[4]),d=1-Number(o[5]),f=Number(o[6])/t,g=1-Number(o[7])/n,p=Number(o[8])/t,_=1-Number(o[9])/n;this.glyphs[a]={charCode:a,advance:c,planeLeft:h,planeBottom:l,planeRight:u,planeTop:d,atlasLeft:f,atlasBottom:g,atlasRight:p,atlasTop:_}}return this}deserializeData(e){let t=new Float32Array(e),n=0,r=t[n++];for(let i=0;i<r;i++){let o=t[n++],a=t[n++],c=t[n++],h=t[n++],l=t[n++],u=t[n++],d=t[n++],f=t[n++],g=t[n++],p=t[n++];this.glyphs[o]={charCode:o,advance:a,planeLeft:c,planeBottom:h,planeRight:l,planeTop:u,atlasLeft:d,atlasBottom:f,atlasRight:g,atlasTop:p}}return this}serializeData(){let e=Object.values(this.glyphs),t=[e.length];for(let n of e){let{charCode:r,advance:i,planeLeft:o,planeBottom:a,planeRight:c,planeTop:h,atlasLeft:l,atlasBottom:u,atlasRight:d,atlasTop:f}=n;t.push(r,i,o,a,c,h,l,u,d,f)}return new Float32Array(t)}},J=class{constructor(e,t,n){he(this,"MAX_VERTICES",65535);he(this,"VERTEX_ELEMENTS",8);this.context=e,this.vertices=new Float32Array(this.VERTEX_ELEMENTS*this.MAX_VERTICES),this.mesh=new fe(e,this.MAX_VERTICES,[new H(2,e.FLOAT,!1,8*4,0),new H(2,e.FLOAT,!1,8*4,2*4),new H(4,e.FLOAT,!1,8*4,4*4)],e.DYNAMIC_DRAW),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.resize(t,n)}resize(e,t){return this.width=e,this.height=t,this.matrix=this.createOrthographicOffCenter(0,e,t,0,-1,1),this}createOrthographicOffCenter(e,t,n,r,i,o){let a=1/(e-t),c=1/(n-r),h=1/(i-o),l=-2*a,u=-2*c,d=2*h,f=(e+t)*a,g=(r+n)*c,p=(o+i)*h;return[l,0,0,0,0,u,0,0,0,0,d,0,f,g,p,1]}clear(e,t,n,r){let{context:i}=this;return i.clearColor(e,t,n,r),i.clear(i.COLOR_BUFFER_BIT),this}beginGeometry(){return this.vertexCount=0,this}endGeometry(){let{VERTEX_ELEMENTS:e,vertexCount:t,vertices:n}=this;if(t!==0)return this.mesh.setDataRange(n,0,e*t),this.mesh.draw(t),this}addVertex(e,t,n,r,i,o,a,c){let{VERTEX_ELEMENTS:h,vertexCount:l,vertices:u}=this;for(let d=0;d<h;d++)u[h*l+d]=arguments[d];return this.vertexCount++,this}drawTriangle(e,t,n,r,i,o,a,c,h,l,u,d,f,g,p,_){let{MAX_VERTICES:E,vertexCount:v}=this;return v+3>=E&&this.endGeometry().beginGeometry(),this.addVertex(e,t,n,r,f,g,p,_).addVertex(i,o,a,c,f,g,p,_).addVertex(h,l,u,d,f,g,p,_)}drawQuad(e,t,n,r,i,o,a,c,h,l,u,d,f,g,p,_,E,v,F,M){return this.drawTriangle(e,t,n,r,i,o,a,c,h,l,u,d,E,v,F,M).drawTriangle(e,t,n,r,h,l,u,d,f,g,p,_,E,v,F,M)}drawRectangle(e,t,n,r,i,o,a,c,h,l,u,d){let f=e,g=t,p=e+n,_=t,E=e+n,v=t+r,F=e,M=t+r;return this.drawQuad(f,g,i,o,p,_,a,o,E,v,a,c,F,M,i,c,h,l,u,d)}drawRectangleOffCenter(e,t,n,r,i,o,a,c,h,l,u,d){let f=n/2,g=r/2,p=e-f,_=t-g,E=e+f,v=t-g,F=e+f,M=t+g,V=e-f,K=t+g;return this.drawQuad(p,_,i,o,E,v,a,o,F,M,a,c,V,K,i,c,h,l,u,d)}drawRotatedRectangleOffCenter(e,t,n,r,i,o,a,c,h,l,u,d,f){let g=n/2,p=r/2,_=Math.sin(i),E=Math.cos(i),v=-g,F=-p,M=g,V=-p,K=g,xe=p,Te=-g,Re=p,De=e+E*v-_*F,Le=t+_*v+E*F,Ue=e+E*M-_*V,Oe=t+_*M+E*V,Be=e+E*K-_*xe,Ie=t+_*K+E*xe,Ne=e+E*Te-_*Re,Pe=t+_*Te+E*Re;return this.drawQuad(De,Le,o,a,Ue,Oe,c,a,Be,Ie,c,h,Ne,Pe,o,h,l,u,d,f)}drawChar(e,t,n,r,i,o,a,c,h){let l=e.glyphs[r];return typeof l>"u"||l===null?this:this.drawRectangle(t+i*l.planeLeft,n+i*l.planeTop,i*(l.planeRight-l.planeLeft),i*(l.planeBottom-l.planeTop),l.atlasLeft,l.atlasTop,l.atlasRight,l.atlasBottom,o,a,c,h)}drawString(e,t,n,r,i,o,a,c,h){let l=0;for(let u=0;u<r.length;u++){let d=r.charCodeAt(u),f=e.glyphs[d];typeof f>"u"||f===null||(this.drawChar(e,t+l,n,d,i,o,a,c,h),l+=i*f.advance)}return this}drawStringOffCenter(e,t,n,r,i,o,a,c,h){let l=this.measureString(e,r,i);return this.drawString(e,t-l/2,n,r,i,o,a,c,h)}measureString(e,t,n){let r=0;for(let i=0;i<t.length;i++){let o=t.charCodeAt(i),a=e.glyphs[o];typeof a>"u"||a===null||(r+=n*a.advance)}return r}delete(){this.mesh.delete()}},ee=class{constructor(e){this.renderer=e,this.buckets=new Map}begin(){return this.buckets.clear(),this}end(){for(let[e,t]of this.buckets.entries()){e.bind(),this.renderer.beginGeometry();for(let{name:n,args:r}of t)this.renderer[n](...r);this.renderer.endGeometry()}return this}addCommand(e,t,n){let r={name:t,args:n};return this.buckets.has(e)?this.buckets.get(e).push(r):this.buckets.set(e,[r]),this}drawTriangle(e,t,n,r,i,o,a,c,h,l,u,d,f,g,p,_,E){return this.addCommand(e,"drawTriangle",[...arguments].slice(1))}drawQuad(e,t,n,r,i,o,a,c,h,l,u,d,f,g,p,_,E,v,F,M,V){return this.addCommand(e,"drawQuad",[...arguments].slice(1))}drawRectangle(e,t,n,r,i,o,a,c,h,l,u,d,f){return this.addCommand(e,"drawRectangle",[...arguments].slice(1))}drawRectangleOffCenter(e,t,n,r,i,o,a,c,h,l,u,d,f){return this.addCommand(e,"drawRectangleOffCenter",[...arguments].slice(1))}drawRotatedRectangleOffCenter(e,t,n,r,i,o,a,c,h,l,u,d,f,g){return this.addCommand(e,"drawRotatedRectangleOffCenter",[...arguments].slice(1))}drawChar(e,t,n,r,i,o,a,c,h,l){return this.addCommand(e,"drawChar",[...arguments].slice(1))}drawString(e,t,n,r,i,o,a,c,h,l){return this.addCommand(e,"drawString",[...arguments].slice(1))}drawStringOffCenter(e,t,n,r,i,o,a,c,h,l){return this.addCommand(e,"drawStringOffCenter",[...arguments].slice(1))}measureString(e,t,n){return this.renderer.measureString(e,t,n)}};var ae=class{get objectType(){return"GameObject"}update(e){}draw(){}},ge=class extends ae{get objectType(){return"TileEntity"}constructor(e,t,n,r=null){super(),this.x=e,this.y=t,this.typeId=n,this.lifetime=0,this.isFalling=!1,this.fallSpeed=.5,this.group=r}update(e){super.update(e),this.lifetime+=e,!this.isFalling&&this.lifetime>2e3&&(this.isFalling=!0),this.isFalling&&(this.y+=e*this.fallSpeed/b);let t=.1,n=G(this.x+t,this.y+1);(S(this.x+t,this.y+1)!==0||n!==null&&n.group!==this.group)&&(ne.add(this),et(),_e(this.x,this.y,this.typeId))}draw(){super.draw();let t=z[this.typeId].texture,n=W[t];D.drawRectangle(n,this.x*b,(this.y-Y)*b,b,b,0,0,1,1,1,1,1,1)}},pe=class extends ae{get objectType(){return"Player"}constructor(){super(),this.x=Math.floor(T/2),this.y=0,this.moveSpeed=.25,this.fallSpeed=.5,this.isOnGround=!0}update(e){super.update(e);let t=.1;if((B("KeyA")||B("ArrowLeft"))&&(this.x-=e*this.moveSpeed/b,te(this.x,this.y+.5,e)),(B("KeyD")||B("ArrowRight"))&&(this.x+=e*this.moveSpeed/b,te(this.x+1,this.y+.5,e)),B("KeyS")||B("ArrowDown")){for(let n of[.5,.25,.75])if(te(this.x+n,this.y+1,e))break}(B("KeyW")||B("ArrowUp"))&&te(this.x+.5,this.y-t,e),this.x<0&&(this.x=0),this.x>T-1&&(this.x=T-1),(S(this.x,this.y+t)!==0||S(this.x,this.y+1-t)!==0||G(this.x,this.y+t)!==null||G(this.x,this.y+1-t)!==null)&&(this.x=Math.ceil(this.x)),(S(this.x+1,this.y+t)!==0||S(this.x+1,this.y+1-t)!==0||G(this.x+1,this.y+t)!==null||G(this.x+1,this.y+1-t)!==null)&&(this.x=Math.floor(this.x)),S(this.x+t,this.y+1)!==0||S(this.x+1-t,this.y+1)!==0||G(this.x+t,this.y+1)!==null||G(this.x+1-t,this.y+1)!==null?(this.isOnGround=!0,this.y=Math.floor(this.y)):(this.isOnGround=!1,this.y+=e*this.fallSpeed/b),Y=this.y-5}draw(){super.draw(),D.drawRectangle(W.player,this.x*b,(this.y-Y)*b,b,b,0,0,1,1,1,1,1,1)}},ne=new Set,z={1:{id:1,texture:"tile_sand",isMovable:!0,breakTime:100},2:{id:2,texture:"tile_dirt",isMovable:!0,breakTime:150},3:{id:3,texture:"tile_stone",isMovable:!0,breakTime:250},4:{id:4,texture:"tile_block",isMovable:!1,breakTime:1e3}},A=4,T=7,b=64,w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1];function y(){return Math.random()<.05?A:1+Math.floor(Math.random()*3)}for(let s=0;s<1e3;s++)if(Math.random()<.1){w.push(A,A,y(),y(),y(),A,A);for(let e=0;e<7;e++)w.push(y())}else if(Math.random()<.1){w.push(y(),y(),A,A,A,y(),y());for(let e=0;e<7;e++)w.push(y())}else if(Math.random()<.1){w.push(y(),A,y(),A,y(),A,y());for(let e=0;e<7;e++)w.push(y())}else for(let e=0;e<7;e++)w.push(y());var re=-1,se=-1,L=0,ye=0;function S(s,e){if(s<0||e<0||s>T)return 0;let t=Math.floor(s)+Math.floor(e)*T;return t>=w.length?0:w[t]}function G(s,e){for(let t of k)if(t.objectType==="TileEntity"&&!t.isFalling&&t.x<=s&&t.y<=e&&t.x+1>=s&&t.y+1>=e)return t;return null}function _e(s,e,t){if(s<0||e<0||s>T)return;let n=Math.floor(s)+Math.floor(e)*T;if(n>=w.length)return 0;w[n]=t}function ke(s,e){let t=[],n=[],r=Math.floor(s)+Math.floor(e)*T,i=S(s,e),o=[r];for(;o.length;){let a=o.pop(),c=a%T,h=Math.floor(a/T),l=S(c,h);l===i&&(t.push({x:c,y:h,index:a,typeId:l,type:z[l]}),c>0&&!n.includes(a-1)&&o.push(a-1),c<T-1&&!n.includes(a+1)&&o.push(a+1),h>0&&!n.includes(a-T)&&o.push(a-T),n.includes(a+T)||o.push(a+T),n.push(a))}return t}function ze(s,e){let t=[],n;for(;(n=S(s,e))!==0&&z[n].isMovable;){let r=Math.floor(s)+Math.floor(e)*T;t.push({x:s,y:e,index:r,typeId:n,type:z[n]}),e--}return t}function te(s,e,t){let n=S(s,e);if(n===0)return!1;let r=Math.floor(s),i=Math.floor(e);if(re===r&&se===i){let o=z[n].breakTime;L+=t/o}else re=r,se=i,L=0;if(L>1){re=-1,se=-1,L=0;let o=ke(s,e);for(let{x:a,y:c}of o)_e(a,c,0);for(let{x:a,y:c}of o)for(let{x:h,y:l,typeId:u}of ze(a,c-1))_e(h,l,0),k.push(new ge(h,l,u,ye));ye++,tt()}return!0}var Ve=`#version 300 es

uniform mat4 matrix;

layout(location = 0) in vec2 position;
layout(location = 1) in vec2 texCoords;
layout(location = 2) in vec4 color;

out vec2 fragTexCoords;
out vec4 fragColor;

void main() {
    gl_Position = matrix * vec4(position, 0, 1);

    fragTexCoords = texCoords;
    fragColor = color;
}
`,He=`#version 300 es

precision mediump float;

uniform sampler2D colorTexture;

in vec2 fragTexCoords;
in vec4 fragColor;

out vec4 color;

void main() {
    color = fragColor * texture(colorTexture, fragTexCoords);
}
`,je=`#version 300 es

uniform mat4 matrix;

layout(location = 0) in vec2 position;
layout(location = 1) in vec2 texCoords;
layout(location = 2) in vec4 color;

out vec2 fragTexCoords;
out vec4 fragColor;

void main() {
    gl_Position = matrix * vec4(position, 0.0, 1.0);

    fragTexCoords = texCoords;
    fragColor = color;
}
`,We=`#version 300 es

precision mediump float;

uniform sampler2D msdfTexture;
uniform float screenPxRange;
uniform float outlineBias;

in vec2 fragTexCoords;
in vec4 fragColor;

out vec4 color;

float median(float r, float g, float b) {
    return max(min(r, g), min(max(r, g), b));
}

void main() {
    vec4 msd = texture(msdfTexture, fragTexCoords);

    float hardDistance = median(msd.r, msd.g, msd.a);
    float softDistance = msd.a;

    float inner = screenPxRange * (hardDistance - 0.5) + 0.5;
    float outer = screenPxRange * (softDistance - 0.5 + outlineBias) + 0.5;

    float innerOpacity = clamp(inner, 0.0, 1.0);
    float outerOpacity = clamp(outer, 0.0, 1.0);

    color = fragColor * innerOpacity + vec4(vec3(0.0), 1.0) * outerOpacity;
}
`,Ye=`#version 300 es

layout(location = 0) in vec2 position;
layout(location = 1) in vec2 texCoords;
layout(location = 2) in vec4 color;

out vec2 fragTexCoords;

void main() {
    gl_Position = vec4(position, 0, 1);

    fragTexCoords = texCoords;
}
`,Ke=`#version 300 es

precision mediump float;

const float weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);

uniform sampler2D colorTexture;
uniform bool horizontal;

in vec2 fragTexCoords;

out vec4 color;

void main() {
    vec2 texelSize = 1.0 / vec2(textureSize(colorTexture, 0));
    vec3 result = texture(colorTexture, fragTexCoords).rgb * weight[0];

    if (horizontal) {
        for (int i = 1; i < 5; i++) {
            result += texture(colorTexture, fragTexCoords + vec2(texelSize.x * float(i), 0.0)).rgb * weight[i];
            result += texture(colorTexture, fragTexCoords - vec2(texelSize.x * float(i), 0.0)).rgb * weight[i];
        }
    } else {
        for (int i = 1; i < 5; i++) {
            result += texture(colorTexture, fragTexCoords + vec2(0.0, texelSize.y * float(i))).rgb * weight[i];
            result += texture(colorTexture, fragTexCoords - vec2(0.0, texelSize.y * float(i))).rgb * weight[i];
        }
    }

    color = vec4(result, 1.0);
}
`,Qe=`#version 300 es

layout(location = 0) in vec2 position;
layout(location = 1) in vec2 texCoords;
layout(location = 2) in vec4 color;

out vec2 fragTexCoords;

void main() {
    gl_Position = vec4(position, 0.0, 1.0);

    fragTexCoords = texCoords;
}
`,qe=`#version 300 es

precision mediump float;

uniform sampler2D colorTexture;
uniform sampler2D blurTexture;

uniform float blurBrightness;

in vec2 fragTexCoords;

out vec4 color;

void main() {
    vec3 result = texture(colorTexture, fragTexCoords).rgb + blurBrightness * texture(blurTexture, fragTexCoords).rgb;
    color = vec4(pow(result, vec3(1.0 / 2.2)), 1.0);
}
`,R=null,m=null,me=null,be=null,Fe=null,Ze=null,Ee=null,W={},$e=null,x=null,D=null,I=null,le=null,j=null,X=null,U=null,Je=null,k=[Je=new pe],ie=[],we=0;function et(){U===null||ie.length===0||(U.play(ie[we%ie.length]),we++)}var oe=[],ve=0;function tt(){U===null||oe.length===0||(U.play(oe[ve%oe.length]),ve++)}async function nt(s){return(await fetch(s)).arrayBuffer()}function Ce(s){return new Promise(e=>{let t=new Image;t.addEventListener("load",()=>e(t)),t.loading="eager",t.src=s})}async function C(s){let t=await(await fetch(s)).arrayBuffer();return U.context.decodeAudioData(t)}function Ae(){let{clientWidth:s,clientHeight:e}=R;R.width=s,R.height=e,x.resize(s,e),I.resize(s,e).attachRenderbuffer(new q(m,s,e)),le.resize(s,e).attachTexture(new O(m,m.TEXTURE_2D,s,e)),j.resize(s,e).attachTexture(new O(m,m.TEXTURE_2D,s,e)),X.resize(s,e).attachTexture(new O(m,m.TEXTURE_2D,s,e))}var ce={};function B(s){return s in ce&&ce[s]===!0}async function Se(){if(R=document.getElementById("canvas"),R===null)return console.error("#canvas not found");if(m=R.getContext("webgl2",{antialias:!1}),m===null)return console.error("Can't create webgl context");be=new P(m,Ve,He),Fe=new P(m,Qe,qe),Ze=new P(m,je,We),Ee=new P(m,Ye,Ke),x=new J(m,R.width,R.height),D=new ee(x),I=new N(m,R.clientWidth,R.clientHeight),le=new N(m,R.clientWidth,R.clientHeight),j=new N(m,R.clientWidth,R.clientHeight),X=new N(m,R.clientWidth,R.clientHeight),await Promise.all([...["white","tile_dirt","tile_stone","tile_sand","tile_block","player"].map(s=>Ce(`./assets/${s}.png`).then(e=>W[s]=new O(m,m.TEXTURE_2D,e.width,e.height,m.SRGB8_ALPHA8).setImage(e).setParameter(m.TEXTURE_MAG_FILTER,m.NEAREST))),Ce("./assets/font.png").then(s=>W.font=new O(m,m.TEXTURE_2D,s.width,s.height,m.RGBA8).setImage(s)),nt("./assets/font.bin").then(s=>$e=new $().deserializeData(s))]),document.addEventListener("contextmenu",s=>s.preventDefault()),document.addEventListener("pointerdown",s=>s.preventDefault()),document.addEventListener("pointermove",s=>s.preventDefault()),document.addEventListener("pointerup",s=>s.preventDefault()),document.addEventListener("click",s=>{s.preventDefault(),U===null&&(U=new Q,U.resume(),C("./assets/bgm.mp3").then(e=>U.play(e,!0)),Promise.all([C("./assets/footstep_carpet_000.mp3"),C("./assets/footstep_carpet_001.mp3"),C("./assets/footstep_carpet_002.mp3"),C("./assets/footstep_carpet_003.mp3"),C("./assets/footstep_carpet_004.mp3")]).then(e=>ie=e),Promise.all([C("./assets/footstep_concrete_000.mp3"),C("./assets/footstep_concrete_001.mp3"),C("./assets/footstep_concrete_002.mp3"),C("./assets/footstep_concrete_003.mp3"),C("./assets/footstep_concrete_004.mp3")]).then(e=>oe=e))}),document.addEventListener("keydown",s=>ce[s.code]=!0),document.addEventListener("keyup",s=>ce[s.code]=!1),Ae(),addEventListener("resize",Ae),requestAnimationFrame(Me)}var rt=1e3/30,Y=0;function Me(s){requestAnimationFrame(Me);let e=Math.min(me!==null?s-me:0,rt);me=s;for(let t of k)t.update(e);ne.size>0&&(k=k.filter(t=>!ne.has(t)),ne.clear()),I.bind(),x.clear(Math.pow(.63,2.2),Math.pow(.88,2.2),Math.pow(.98,2.2),1),be.bind().setUniformMatrix("matrix",x.matrix),D.begin();for(let t of k)t.draw();for(let t=0;t<w.length;t++){let n=w[t];if(n===0)continue;let r=t%T,i=Math.floor(t/T),a=z[n].texture,c=W[a];re===r&&se===i?D.drawRectangle(c,r*b,(i-Y)*b,b,b,0,0,1,1,1-L,1-L,1-L,1-L*L):D.drawRectangle(c,r*b,(i-Y)*b,b,b,0,0,1,1,1,1,1,1)}D.end(),I.unbind(),I.blit(le),I.bind(),x.clear(0,0,0,0),be.bind().setUniformMatrix("matrix",x.matrix),D.begin();for(let t of k)t.objectType==="TileEntity"&&t.draw();D.end(),I.unbind(),I.blit(X);for(let t=0;t<4;t++)Ee.bind().setUniform("horizontal",!0),j.bind(),X.attachment.bind(),x.beginGeometry(),x.drawRectangleOffCenter(0,0,2,2,0,0,1,1,1,1,1,1),x.endGeometry(),j.unbind(),Ee.bind().setUniform("horizontal",!1),X.bind(),j.attachment.bind(),x.beginGeometry(),x.drawRectangleOffCenter(0,0,2,2,0,0,1,1,1,1,1,1),x.endGeometry(),X.unbind();m.viewport(0,0,x.width,x.height),Fe.bind().setUniformInteger("blurTexture",1).setUniform("blurBrightness",(Math.sin(8*s/1e3)+1)/2),le.attachment.bind(),X.attachment.bind(1),x.beginGeometry(),x.drawRectangleOffCenter(0,0,2,2,0,0,1,1,1,1,1,1),x.endGeometry()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Se):Se();})();
//# sourceMappingURL=index.min.js.map
